<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ê³¼í•™ ìˆ˜í–‰ í€´ì¦ˆ</title>

<!-- Favicon -->
<link rel="icon" href="https://img.icons8.com/color/48/physics.png" type="image/png">

<style>
  * { box-sizing: border-box; font-family: "Noto Sans KR", sans-serif; }
  html, body { height: 100%; margin: 0; background: #f2f6ff; }
  body { display: flex; justify-content: center; align-items: center; }
  section { display: none; flex-direction: column; align-items: center; text-align: center; }
  #homeSection { display: flex; flex-direction: column; gap: 15px; }
  button {
    background: #4c6ef5; color: white; border: none; padding: 12px 24px;
    border-radius: 10px; cursor: pointer; font-size: 16px;
    transition: background 0.3s;
  }
  button:hover { background: #364fc7; }
  input { padding: 10px; font-size: 16px; width: 250px; border: 2px solid #4c6ef5; border-radius: 8px; }
  .correct { color: #2f9e44; font-weight: bold; }
  .wrong { color: #e03131; font-weight: bold; }
  #adminSection {
    width: 100%; max-width: 600px; background: white;
    border-radius: 12px; padding: 20px; overflow-y: auto; max-height: 90vh;
  }
  .admin-item { background: #f8f9fa; border-radius: 10px; padding: 10px; margin-bottom: 12px; text-align: left; }
  .backHomeBtn { margin-top: 10px; background: #adb5bd; }
</style>
</head>

<body>

<section id="homeSection">
  <h1>ğŸ”¬ í™”í•™ì‹ í€´ì¦ˆ</h1>
</section>

<section id="guideSection">
  <p>ìœ„ì²¨ìëŠ” '^', ì•„ë˜ì²¨ìëŠ” '_'ë¥¼ í™œìš©í•˜ì„¸ìš”.<br>ê´„í˜¸ê°€ í•„ìš”í•œ ê²½ìš° ë°˜ë“œì‹œ í¬í•¨í•´ì£¼ì„¸ìš”.<br>ì•„ë˜ì²¨ìë¥¼ ë¨¼ì € ì‘ì„± í›„ ìœ„ì²¨ìë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>
  <button id="guideConfirm">í™•ì¸</button>
</section>

<section id="quizSection">
  <h2 id="modeDisplay">ëª¨ë“œ: ì¼ë°˜ ëª¨ë“œ</h2>
  <div id="quizBox"></div>
</section>

<section id="adminSection">
  <h2>ê´€ë¦¬ì íŒ¨ë„</h2>
  <button id="addQuizBtn">ë¬¸ì œ ì¶”ê°€</button>
  <div id="adminList"></div>
  <button class="backHomeBtn">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

// ğŸ”¹ Firebase ì„¤ì •
const firebaseConfig = {
  apiKey: "AIzaSyCLXhRToRyjQ1qXkpO37IOXm1JasEzhXNw",
  authDomain: "quizproject-a64ce.firebaseapp.com",
  projectId: "quizproject-a64ce",
  storageBucket: "quizproject-a64ce.firebasestorage.app",
  messagingSenderId: "14288490981",
  appId: "1:14288490981:web:11c5bf919120fbf3f09f0c"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ğŸ”¹ ë³€ìˆ˜
const homeSection = document.getElementById("homeSection");
const startBtn = document.createElement("button");
startBtn.id = "startBtn";
startBtn.textContent = "í€´ì¦ˆ ì‹œì‘í•˜ê¸°";
const adminBtn = document.createElement("button");
adminBtn.id = "adminBtn";
adminBtn.textContent = "ê´€ë¦¬ì íŒ¨ë„";
homeSection.appendChild(startBtn);
homeSection.appendChild(adminBtn);

const guideSection = document.getElementById("guideSection");
const quizSection = document.getElementById("quizSection");
const modeDisplay = document.getElementById("modeDisplay");

let quizList = [];
let currentIndex = 0;
let wrongList = [];
let reverseMode = false; // false = ì¼ë°˜, true = ê±°ê¾¸ë¡œ

function showScreen(screen) {
  [homeSection, guideSection, quizSection, document.getElementById("adminSection")].forEach(s => s.style.display="none");
  screen.style.display = "flex";
}

// ğŸ”¹ í€´ì¦ˆ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadQuiz() {
  const snapshot = await getDocs(collection(db, "quizzes"));
  quizList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  quizList = quizList.sort(() => Math.random() - 0.5);
}

// ğŸ”¹ í€´ì¦ˆ í‘œì‹œ
function showQuiz() {
  if (quizList.length === 0) return;
  if (currentIndex >= quizList.length) {
    if (wrongList.length > 0) {
      quizList = [...wrongList]; wrongList = []; currentIndex = 0; showQuiz(); return;
    } else {
      document.getElementById("quizBox").innerHTML = `
        <h2>ëª¨ë“  ë¬¸ì œë¥¼ ë§ì·„ì–´ìš”!</h2>
        <button id="goHome">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      `;
      document.getElementById("goHome").onclick = () => showScreen(homeSection);
      return;
    }
  }

  const quiz = quizList[currentIndex];
  const question = reverseMode ? quiz.answer : quiz.question;
  const answer = reverseMode ? quiz.question : quiz.answer;

  document.getElementById("quizBox").innerHTML = `
    <h3>${question}</h3>
    <input type="text" id="answerInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”." />
    <button id="submitAnswer">í™•ì¸</button>
    <div id="result"></div>
  `;

  const input = document.getElementById("answerInput");
  const resultDiv = document.getElementById("result");
  input.focus();

  const checkAnswer = () => {
    const userAnswer = input.value.trim();
    if (userAnswer === answer.trim()) {
      resultDiv.innerHTML = `<p class="correct">ì •ë‹µì…ë‹ˆë‹¤!</p>`;
    } else {
      resultDiv.innerHTML = `<p class="wrong">âŒ ì •ë‹µì€ ${answer}ì…ë‹ˆë‹¤.</p>`;
      wrongList.push(quiz);
    }
    currentIndex++;
    setTimeout(showQuiz, 1200);
  };

  document.getElementById("submitAnswer").onclick = checkAnswer;
  input.addEventListener("keydown", e => { if(e.key==="Enter") checkAnswer(); });
}

// ğŸ”¹ í™ˆ í™”ë©´ ë²„íŠ¼ ì´ë²¤íŠ¸
startBtn.onclick = () => showScreen(guideSection);

document.getElementById("guideConfirm").onclick = async () => {
  guideSection.style.display="none";
  quizSection.style.display="flex";
  modeDisplay.textContent = reverseMode ? "ëª¨ë“œ: ê±°ê¾¸ë¡œ ëª¨ë“œ" : "ëª¨ë“œ: ì¼ë°˜ ëª¨ë“œ";
  await loadQuiz();
  showQuiz();
};

// ğŸ”¹ í™ˆ í™”ë©´ ê±°ê¾¸ë¡œ ë¬¸ì œí’€ê¸° ë²„íŠ¼ (í† ê¸€)
const reverseModeBtn = document.createElement("button");
reverseModeBtn.textContent = "ê±°ê¾¸ë¡œ ë¬¸ì œí’€ê¸°";
reverseModeBtn.style.marginBottom = "10px";
reverseModeBtn.onclick = () => {
  reverseMode = !reverseMode;
  if(reverseMode) reverseModeBtn.textContent = "ë¬¸ì œí’€ê¸°";
  else reverseModeBtn.textContent = "ê±°ê¾¸ë¡œ ë¬¸ì œí’€ê¸°";
};
homeSection.insertBefore(reverseModeBtn, startBtn);

// ğŸ”¹ ê´€ë¦¬ì íŒ¨ë„
adminBtn.onclick = async () => {
  const inputCode = prompt("ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (parseInt(inputCode) === 251414) {
    showScreen(document.getElementById("adminSection"));
    loadAdminPanel();
  } else alert("ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤.");
};

async function loadAdminPanel() {
  const snapshot = await getDocs(collection(db, "quizzes"));
  const adminList = document.getElementById("adminList");
  adminList.innerHTML = "";
  snapshot.forEach(docSnap => {
    const quiz = docSnap.data();
    const div = document.createElement("div");
    div.className = "admin-item";
    div.innerHTML = `
      <p><b>ë¬¸ì œ:</b> ${quiz.question}</p>
      <p><b>ì •ë‹µ:</b> ${quiz.answer}</p>
      <button class="editBtn">ìˆ˜ì •</button>
      <button class="deleteBtn">ì‚­ì œ</button>
    `;
    adminList.appendChild(div);

    div.querySelector(".editBtn").onclick = async () => {
      const newQ = prompt("ìƒˆ ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”:", quiz.question);
      const newA = prompt("ìƒˆ ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”:", quiz.answer);
      if(newQ && newA) await updateDoc(doc(db,"quizzes",docSnap.id),{question:newQ, answer:newA});
      loadAdminPanel();
    };
    div.querySelector(".deleteBtn").onclick = async () => { await deleteDoc(doc(db,"quizzes",docSnap.id)); loadAdminPanel(); };
  });
}

document.getElementById("addQuizBtn").onclick = async () => {
  const q = prompt("ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  const a = prompt("ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”:");
  if(q && a) await addDoc(collection(db,"quizzes"), {question:q, answer:a});
  loadAdminPanel();
};

document.querySelectorAll(".backHomeBtn").forEach(btn => btn.onclick = () => showScreen(homeSection));

</script>
</body>
</html>
